<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>üí™ Chuck Norris Jokes</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <div class="page-container">

    <!-- CHISTE ACTUAL -->
    <div *ngIf="currentJoke" class="joke-card">
      <div class="joke-header">
        <ion-avatar>
          <img [src]="currentJoke.icon_url" alt="Chuck Norris">
        </ion-avatar>
        <div class="header-info">
          <h3>Chuck Norris</h3>
          <ion-badge 
            *ngFor="let cat of currentJoke.categories" 
            [color]="getCategoryColor(cat)">
            {{ cat }}
          </ion-badge>
          <ion-badge *ngIf="currentJoke.categories.length === 0" color="medium">
            random
          </ion-badge>
        </div>
      </div>

      <div class="joke-content">
        <ion-icon name="chatbox-ellipses-outline" class="quote-icon"></ion-icon>
        <p class="joke-text">{{ currentJoke.value }}</p>
      </div>

      <div class="joke-actions">
        <ion-button fill="clear" (click)="addToFavorites()">
          <ion-icon 
            [name]="isFavorite() ? 'heart' : 'heart-outline'" 
            [color]="isFavorite() ? 'danger' : ''"
            slot="icon-only">
          </ion-icon>
        </ion-button>
        <ion-button fill="clear" (click)="shareJoke()">
          <ion-icon name="share-social-outline" slot="icon-only"></ion-icon>
        </ion-button>
        <ion-button fill="clear" (click)="getRandomJoke()">
          <ion-icon name="refresh-outline" slot="icon-only"></ion-icon>
        </ion-button>
      </div>
    </div>

    <!-- FILTRO POR CATEGOR√çA -->
    <div class="category-section">
      <h3>Categor√≠as</h3>
      <div class="category-chips">
        <ion-chip 
          [outline]="selectedCategory !== ''"
          (click)="selectedCategory = ''; getRandomJoke()">
          <ion-label>Todas</ion-label>
        </ion-chip>
        <ion-chip 
          *ngFor="let category of categories"
          [outline]="selectedCategory !== category"
          [color]="getCategoryColor(category)"
          (click)="selectedCategory = category; getJokeByCategory()">
          <ion-label>{{ category }}</ion-label>
        </ion-chip>
      </div>
    </div>

    <!-- BOT√ìN PRINCIPAL -->
    <ion-button 
      expand="block" 
      size="large" 
      (click)="getRandomJoke()"
      class="main-button">
      <ion-icon name="dice-outline" slot="start"></ion-icon>
      Nuevo Chiste
    </ion-button>

    <!-- FAVORITOS -->
    <div *ngIf="favoriteJokes.length > 0" class="favorites-section">
      <div class="section-header">
        <h3>‚ù§Ô∏è Favoritos</h3>
        <ion-badge color="danger">{{ favoriteJokes.length }}</ion-badge>
      </div>

      <ion-list>
        <ion-item-sliding *ngFor="let joke of favoriteJokes">
          <ion-item button (click)="viewJoke(joke)">
            <ion-avatar slot="start">
              <img [src]="joke.icon_url" alt="Chuck">
            </ion-avatar>
            <ion-label class="ion-text-wrap">
              <p>{{ joke.value | slice:0:80 }}{{ joke.value.length > 80 ? '...' : '' }}</p>
            </ion-label>
          </ion-item>
          
          <ion-item-options side="end">
            <ion-item-option color="danger" (click)="removeFromFavorites(joke.id)">
              <ion-icon name="trash" slot="icon-only"></ion-icon>
            </ion-item-option>
          </ion-item-options>
        </ion-item-sliding>
      </ion-list>
    </div>

    <!-- HISTORIAL -->
    <div *ngIf="jokeHistory.length > 0" class="history-section">
      <h3>üìú Historial Reciente</h3>
      <ion-list>
        <ion-item 
          *ngFor="let joke of jokeHistory"
          button 
          (click)="viewJoke(joke)"
          [class.current]="currentJoke && joke.id === currentJoke.id">
          <ion-label class="ion-text-wrap">
            <p>{{ joke.value | slice:0:60 }}{{ joke.value.length > 60 ? '...' : '' }}</p>
          </ion-label>
          <ion-icon 
            *ngIf="currentJoke && joke.id === currentJoke.id" 
            name="checkmark-circle" 
            color="primary" 
            slot="end">
          </ion-icon>
        </ion-item>
      </ion-list>
    </div>

  </div>
</ion-content>